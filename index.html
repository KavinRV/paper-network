<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Paper Network</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- vis-network (graph visualization) -->
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #111827, #020617);
      color: #9db1d8;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 0.75rem 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      backdrop-filter: blur(12px);
      background: radial-gradient(circle at top, rgba(15,23,42,0.9), rgba(15,23,42,0.7));
      border-bottom: 1px solid rgba(148,163,184,0.3);
    }

    .title {
      font-size: 1.2rem;
      font-weight: 600;
      letter-spacing: 0.04em;
    }

    .controls {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 0.4rem 0.9rem;
      font-size: 0.85rem;
      cursor: pointer;
      background: rgba(148,163,184,0.2);
      color: #e5e7eb;
      backdrop-filter: blur(10px);
      transition: background 0.15s, transform 0.05s, box-shadow 0.15s;
      box-shadow: 0 0 0 1px rgba(148,163,184,0.4);
    }

    button:hover {
      background: rgba(148,163,184,0.35);
      transform: translateY(-0.5px);
    }

    button:active {
      transform: translateY(0.5px) scale(0.99);
    }

    button.primary {
      background: linear-gradient(135deg, #22c55e, #14b8a6);
      box-shadow: 0 8px 20px rgba(34,197,94,0.35);
      color: #022c22;
      font-weight: 600;
    }

    button.primary:hover {
      background: linear-gradient(135deg, #4ade80, #22c55e);
    }

    .pill {
      padding: 0.25rem 0.7rem;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.6);
      color: #cbd5f5;
    }

    #app-root {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(260px, 0.95fr);
      gap: 0.5rem;
      padding: 0.5rem 0.75rem 0.75rem;
      transition: filter 0.3s ease, transform 0.3s ease;
    }

    #app-root.blurred {
      filter: blur(6px);
      transform: scale(0.99);
    }

    #network {
      border-radius: 1.25rem;
      background: radial-gradient(circle at top left, #0f172a, #020617);
      border: 1px solid rgba(148,163,184,0.35);
      box-shadow: 0 24px 60px rgba(15,23,42,0.75);
      height: calc(100vh - 96px);
    }

    #side-panel {
      border-radius: 1.25rem;
      background: linear-gradient(145deg, rgba(15,23,42,0.96), rgba(17,24,39,0.96));
      border: 1px solid rgba(148,163,184,0.35);
      box-shadow: 0 24px 60px rgba(15,23,42,0.9);
      padding: 0.9rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    #side-panel h2 {
      font-size: 0.95rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #9ca3af;
    }

    .field-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
      margin-bottom: 0.25rem;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
    }

    .chip {
      font-size: 0.7rem;
      padding: 0.15rem 0.55rem;
      border-radius: 999px;
      border: 1px solid rgba(59,130,246,0.6);
      background: radial-gradient(circle at top, rgba(37,99,235,0.18), rgba(15,23,42,0.95));
    }

    textarea,
    input {
      width: 100%;
      border-radius: 0.9rem;
      border: 1px solid rgba(148,163,184,0.35);
      background: rgba(15,23,42,0.9);
      color: #e5e7eb;
      padding: 0.5rem 0.7rem;
      font-size: 0.8rem;
      resize: vertical;
      min-height: 2.2rem;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
    }

    textarea:focus,
    input:focus {
      border-color: rgba(59,130,246,0.9);
      box-shadow: 0 0 0 1px rgba(59,130,246,0.7);
      background: rgba(15,23,42,1);
    }

    #edit-hint {
      font-size: 0.75rem;
      color: #6b7280;
    }

    /* Modal overlay */

    #modal-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
      background: radial-gradient(circle at top, rgba(15,23,42,0.7), rgba(0,0,0,0.85));
      backdrop-filter: blur(18px);
    }

    #modal-overlay.show {
      display: flex;
    }

    .modal-card {
      width: min(720px, 92vw);
      max-height: 82vh;
      border-radius: 1.5rem;
      background: radial-gradient(circle at top, #020617, #020617);
      border: 1px solid rgba(148,163,184,0.5);
      box-shadow: 0 30px 90px rgba(0,0,0,0.9);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .modal-image {
      height: 180px;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position: relative;
    }

    .modal-image::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, rgba(15,23,42,0.1), rgba(15,23,42,0.9));
    }

    .modal-header {
      position: absolute;
      left: 1.1rem;
      bottom: 0.8rem;
      right: 3rem;
      z-index: 1;
    }

    .modal-header-title {
      font-size: 1.15rem;
      font-weight: 600;
      text-shadow: 0 14px 30px rgba(0,0,0,0.9);
    }

    .modal-type-pill {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 0.15rem 0.6rem;
      border-radius: 999px;
      background: rgba(15,23,42,0.7);
      border: 1px solid rgba(148,163,184,0.5);
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      margin-bottom: 0.25rem;
    }

    .modal-body {
      padding: 0.9rem 1.2rem 1rem;
      overflow: auto;
    }

    .modal-section-title {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #9ca3af;
      margin-bottom: 0.3rem;
    }

    .modal-description {
      font-size: 0.85rem;
      line-height: 1.4;
      color: #d1d5db;
      white-space: pre-wrap;
    }

    .modal-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 0.6rem;
      margin-top: 0.6rem;
      font-size: 0.8rem;
    }

    .modal-close {
      position: absolute;
      top: 0.7rem;
      right: 0.7rem;
      z-index: 2;
      width: 28px;
      height: 28px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(15,23,42,0.85);
      border: 1px solid rgba(148,163,184,0.8);
      color: #e5e7eb;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
    }

    .modal-link {
      font-size: 0.8rem;
      color: #60a5fa;
      text-decoration: none;
    }

    .modal-link:hover {
      text-decoration: underline;
    }

    @media (max-width: 900px) {
      #app-root {
        grid-template-columns: minmax(0, 1fr);
      }
      #network {
        height: 60vh;
      }
      #side-panel {
        height: auto;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="title">ðŸ“š Paper / Concept Network</div>
    <div class="controls">
      <span class="pill" id="view-status">View mode</span>
      <button id="toggle-edit">Edit mode</button>
      <button id="export-graph" class="primary">Export graph.json</button>
    </div>
  </header>

  <div id="app-root">
    <div id="network"></div>

    <aside id="side-panel">
      <h2>Node details / editor</h2>
      <p id="edit-hint">
        Click a node to view its details.  
        When <strong>Edit mode</strong> is on, you can change fields and drag from one node to another to create edges.
      </p>

      <div>
        <div class="field-label">Selected node</div>
        <div class="chips" id="selected-node-chip">
          <span class="pill">None</span>
        </div>
      </div>

      <div>
        <div class="field-label">Title</div>
        <input id="edit-title" placeholder="Title of paper / area" />
      </div>

      <div>
        <div class="field-label">Short name (node label)</div>
        <input id="edit-shortname" placeholder="Short label shown in graph" />
      </div>

      <div>
        <div class="field-label">Tags (comma separated)</div>
        <input id="edit-tags" placeholder="decoding, graph theory, ..." />
      </div>

      <div>
        <div class="field-label">Color (for areas)</div>
        <input id="edit-color" placeholder="#ff9f43" />
      </div>

      <div>
        <div class="field-label">Paper URL</div>
        <input id="edit-url" placeholder="https://arxiv.org/..." />
      </div>

      <div>
        <div class="field-label">Conference</div>
        <input id="edit-conf" placeholder="EMNLP 2025, ICLR 2024, ..." />
      </div>

      <div>
        <div class="field-label">Image URL / path</div>
        <input id="edit-image" placeholder="assets/llm.png" />
      </div>

      <div>
        <div class="field-label">Description</div>
        <textarea id="edit-description" rows="6"
          placeholder="Write your own short explanation or notes about this node. Supports plain text for now."></textarea>
      </div>

      <button id="save-node" class="primary">Apply edits to node (in memory)</button>
    </aside>
  </div>

  <!-- Node Modal -->
  <div id="modal-overlay">
    <div class="modal-card">
      <div class="modal-image" id="modal-image">
        <div class="modal-header">
          <div class="modal-type-pill" id="modal-type-pill">
            <span id="modal-type"></span>
          </div>
          <div class="modal-header-title" id="modal-title"></div>
        </div>
        <button class="modal-close" id="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="modal-section-title">Summary</div>
        <div class="modal-description" id="modal-description"></div>

        <div class="modal-section-title" style="margin-top:0.8rem;">Metadata</div>
        <div class="modal-meta">
          <div>
            <strong>Short name</strong><br />
            <span id="modal-shortname"></span>
          </div>
          <div>
            <strong>Tags</strong><br />
            <span id="modal-tags"></span>
          </div>
          <div id="modal-conf-wrapper">
            <strong>Conference</strong><br />
            <span id="modal-conference"></span>
          </div>
          <div id="modal-link-wrapper">
            <strong>Link</strong><br />
            <a href="#" target="_blank" rel="noopener" class="modal-link" id="modal-link">Open paper</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let graphData = null;
    let network = null;
    let visNodes = null;
    let visEdges = null;
    let editMode = false;
    let currentNodeId = null;

    async function loadGraph() {
      const res = await fetch("graph.json");
      graphData = await res.json();

      const nodeItems = graphData.nodes.map((n) => ({
        id: n.id,
        label: n.shortName || n.title,
        title: n.title,
        color: n.color || (n.type === "area" ? "#f97316" : "#38bdf8"),
        shape: "dot",
        size: n.type === "area" ? 26 : 16,
        font: {
          color: "#e5e7eb",
          face: "system-ui"
        }
      }));

      const edgeItems = graphData.edges.map((e, idx) => ({
        id: e.id || "edge-" + idx,
        from: e.from,
        to: e.to,
        arrows: e.directed ? "to" : "",
        physics: true,
        smooth: true
      }));

      visNodes = new vis.DataSet(nodeItems);
      visEdges = new vis.DataSet(edgeItems);

      const container = document.getElementById("network");
      const data = { nodes: visNodes, edges: visEdges };
      const options = {
        autoResize: true,
        physics: {
          stabilization: true,
          barnesHut: {
            gravitationalConstant: -12000,
            springLength: 140,
            springConstant: 0.015
          }
        },
        interaction: {
          hover: true,
          dragNodes: true,
          zoomView: true
        },
        nodes: {
          borderWidth: 1,
          borderWidthSelected: 2,
        },
        edges: {
          color: { color: "rgba(148,163,184,0.7)", highlight: "#e5e7eb" },
          width: 1.2,
          selectionWidth: 2
        },
        manipulation: {
          enabled: false,
          addEdge: function (edgeData, callback) {
            if (!editMode) {
              callback(null);
              return;
            }
            edgeData.arrows = "to";
            visEdges.add(edgeData);

            graphData.edges.push({
              id: edgeData.id,
              from: edgeData.from,
              to: edgeData.to,
              directed: true,
              kind: "custom"
            });

            callback(edgeData);
          },
          addNode: false,
          editNode: false,
          deleteNode: false,
          deleteEdge: false
        }
      };

      network = new vis.Network(container, data, options);

      network.on("click", (params) => {
        if (params.nodes.length === 1) {
          const nodeId = params.nodes[0];
          currentNodeId = nodeId;
          const nodeData = graphData.nodes.find((n) => n.id === nodeId);
          if (nodeData) {
            populateSidePanel(nodeData);
            openNodeModal(nodeData);
          }
        }
      });
    }

    function populateSidePanel(node) {
      document.getElementById("selected-node-chip").innerHTML = `
        <span class="pill">${node.type.toUpperCase()}</span>
        <span class="pill">${node.shortName || node.title}</span>
      `;
      document.getElementById("edit-title").value = node.title || "";
      document.getElementById("edit-shortname").value = node.shortName || "";
      document.getElementById("edit-tags").value = (node.tags || []).join(", ");
      document.getElementById("edit-color").value = node.color || "";
      document.getElementById("edit-url").value = node.paperUrl || "";
      document.getElementById("edit-conf").value = node.conference || "";
      document.getElementById("edit-image").value = node.image || "";
      document.getElementById("edit-description").value = node.description || "";
    }

    function openNodeModal(node) {
      document.getElementById("app-root").classList.add("blurred");
      const overlay = document.getElementById("modal-overlay");
      overlay.classList.add("show");

      const imgDiv = document.getElementById("modal-image");
      if (node.image) {
        imgDiv.style.backgroundImage = `url("${node.image}")`;
      } else {
        imgDiv.style.backgroundImage =
          "linear-gradient(135deg, #0f172a, #1f2937)";
      }

      document.getElementById("modal-type").textContent =
        node.type === "paper" ? "Paper" : "Area / Concept";
      document.getElementById("modal-title").textContent =
        node.title || node.shortName || node.id;
      document.getElementById("modal-description").textContent =
        node.description || "No description added yet.";

      document.getElementById("modal-shortname").textContent =
        node.shortName || "â€”";
      document.getElementById("modal-tags").textContent =
        (node.tags || []).join(", ") || "â€”";

      const confWrapper = document.getElementById("modal-conf-wrapper");
      const linkWrapper = document.getElementById("modal-link-wrapper");

      if (node.type === "paper") {
        confWrapper.style.display = "block";
        linkWrapper.style.display = "block";
        document.getElementById("modal-conference").textContent =
          node.conference || "â€”";
        if (node.paperUrl) {
          document.getElementById("modal-link").href = node.paperUrl;
          document.getElementById("modal-link").textContent = node.paperUrl;
        } else {
          document.getElementById("modal-link").href = "#";
          document.getElementById("modal-link").textContent = "â€”";
        }
      } else {
        confWrapper.style.display = "none";
        linkWrapper.style.display = "none";
      }
    }

    function closeNodeModal() {
      document.getElementById("app-root").classList.remove("blurred");
      document.getElementById("modal-overlay").classList.remove("show");
    }

    function toggleEditMode() {
      editMode = !editMode;
      const viewStatus = document.getElementById("view-status");
      const toggleBtn = document.getElementById("toggle-edit");

      if (editMode) {
        viewStatus.textContent = "Edit mode (local only)";
        toggleBtn.textContent = "Exit edit mode";
        network.setOptions({ manipulation: { enabled: true } });
      } else {
        viewStatus.textContent = "View mode";
        toggleBtn.textContent = "Edit mode";
        network.setOptions({ manipulation: { enabled: false } });
      }
    }

    function applyNodeEdits() {
      if (!currentNodeId || !graphData) return;
      const node = graphData.nodes.find((n) => n.id === currentNodeId);
      if (!node) return;

      node.title = document.getElementById("edit-title").value || node.title;
      node.shortName = document.getElementById("edit-shortname").value || "";
      node.tags = document
        .getElementById("edit-tags")
        .value.split(",")
        .map((t) => t.trim())
        .filter((t) => t !== "");
      node.color = document.getElementById("edit-color").value || node.color;
      node.paperUrl = document.getElementById("edit-url").value || "";
      node.conference = document.getElementById("edit-conf").value || "";
      node.image = document.getElementById("edit-image").value || "";
      node.description =
        document.getElementById("edit-description").value || "";

      visNodes.update({
        id: node.id,
        label: node.shortName || node.title,
        color: node.color || (node.type === "area" ? "#f97316" : "#38bdf8")
      });

      populateSidePanel(node);
    }

    function exportGraph() {
      if (!graphData) return;
      const blob = new Blob([JSON.stringify(graphData, null, 2)], {
        type: "application/json"
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "graph.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    document.getElementById("modal-close").addEventListener("click", closeNodeModal);
    document.getElementById("modal-overlay").addEventListener("click", (e) => {
      if (e.target.id === "modal-overlay") closeNodeModal();
    });
    document.getElementById("toggle-edit").addEventListener("click", toggleEditMode);
    document.getElementById("save-node").addEventListener("click", applyNodeEdits);
    document.getElementById("export-graph").addEventListener("click", exportGraph);

    loadGraph();
  </script>
</body>
</html>
